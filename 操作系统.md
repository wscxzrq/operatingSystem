# 操作系统

## 第一章 操作系统概论

### 1.**计算机系统**

计算机系统包括<font color='#EF4444'>硬件（子）系统</font>和<font color='#EF4444'>软件（子）系统</font>

​	<font color='#EF4444'>硬件系统</font>是计算机系统赖以工作的`实体`

​	<font color='#EF4444'>软件系统</font>保证计算机系统按`用户指定的要求协调工作`

计算机系统的`资源`包括两大类：<font color='#EF4444'>硬件资源</font>和<font color='#EF4444'>软件资源</font>

### 2.操作系统的特征

1. <font color='#EF4444'>并发性</font>：并发性是指在计算机系统中同时存在若干正在运行的程序，从<font color='#EF4444'>宏观</font>上来看，这些程序在同时向前推进

   <font color='#EF4444'>见到宏观选并发</font>

   体现在两个方面：

   1. 用户程序与<font color='#EF4444'>用户程序</font>之间并发执行
   1. 用户程序与<font color='#EF4444'>操作系统</font>之间并发执行

   <font color='#EF4444'>并行性</font>与<font color='#EF4444'>并发性</font>的区别

   并行性：同一<font color='#EF4444'>时刻</font>发生，微观意义（比如ABC三人同时六点起床）

   并发性：<font color='#EF4444'>同一时间间隔内</font>发生，宏观意义（ABC三人都在六点到六点十五起床）

1. <font color='#EF4444'>共享性</font>：操作系统程序与多个用户程序<font color='#EF4444'>共用</font>系统中的各种资源

   这种共享性是在<font color='#EF4444'>操作系统</font>控制下实现的

   资源的共享性主要针对计算机系统中的以下几个重要资源

   中央处理器、内存储器、外存储器、外部设备 <font color='#EF4444'>所有硬件资源</font>

   在计算机系统中，对资源的共享一般有两种形式<font color='#EF4444'>互斥</font>共享和<font color='#EF4444'>同时</font>共享

   <font color='#EF4444'>互斥</font>共享：<font color='#67C23A'>打印机、磁带机、扫描仪等</font>，在某个时间段内<font color='#409EFF'>只能由某一个用户程序使用</font>

   <font color='#EF4444'>同时</font>共享：<font color='#67C23A'>在线文档</font>，在某个时间段内<font color='#409EFF'>可以由多个用户程序使用</font>

1. <font color='#EF4444'>虚拟性</font>：简单来说就是让你感觉有比实际更多的东西在为你服务

   具体表现为：`虚拟内存`、`虚拟外设`

1. <font color='#EF4444'>异步性</font>：在操作系统中，各个程序的执行速度和进展情况是不一样的，而且不可预测

   例如：下载一个大文件和运行一个游戏比速度

### 3.研究操作系统的观点

**进程**的观点：进程可以看作运行中的程序是动态的

**资源管理**的观点：一个是硬件资源，一个是软件资源

**虚机器**的观点：将操作系统的功能分为若干层次，每个层次完成特定的功能，从而构成一个虚机器

**服务提供者**的观点：把操作系统看作是服务提供者，这个服务提供者提供了一组功能强大，方便易用的广义的指令称为系统调用

### 4.操作系统的功能

1. <font color='#EF4444'>进程管理</font>

   实质：对`中央处理器（CPU）`进行管理

   进程管理的主要内容：

   1. **进程控制**：主要处理<font color='#67C23A'>进程的创建</font>、<font color='#67C23A'>状态转换</font>、<font color='#67C23A'>进程撤销</font>以及相关进程资源的分配与回收等事物

   1. **进程同步**：主要处理进程之间的关系，包括进行的<font color='#67C23A'>同步</font>和<font color='#67C23A'>互斥</font>

   1. **进程间通信**：主要处理<font color='#67C23A'>进程之间相互协作</font>信息<font color='#67C23A'>交换</font>问题

   1. **调度**：按照一定的<font color='#67C23A'>算法</font>从就绪队列中挑选一个<font color='#67C23A'>进程执行</font>

      <font color='#EF4444'>控制通信步（同步）调（调度）</font>

1. <font color='#EF4444'>存储管理</font>

   存储管理的任务是管理计算机内存的资源

   概括地说，存储管理有三个方面的任务

   1. **内存的分配与回收**
   1. **存储保护**
   1. **内存扩充**

1. <font color='#EF4444'>文件管理</font>

   在计算机系统中的信息资源（如程序和数据）是以<font color='#EF4444'>文件</font>的形式存储在外存储器（如磁盘、磁带）上的，需要时再把他们装入内存

   有三方面任务

   1. **文件存储空间的管理**
   1. **目录管理**
   1. **文件系统的安全性**

1. <font color='#EF4444'>设备管理</font>

   由操作系统的设备管理功能负责外部设备的分配、启动和故障处理，用户不必详细了解设备及接口的技术细节，就可以方便地通过操作系统提供的设备管理手段，对设备进行操作

1. <font color='#EF4444'>用户接口</font>

   提供面向用户使用的交互接口

   1. 命令接口（cmd、shell）
   1. 应用程序接口（API）

<font color='#EF4444'>用户存储进程设备文件</font>

### 5.不同时期的操作系统

<font color='#EF4444'>历史时期</font>

1. 第一代电子管时代（1946 年～1957 年）
1. 第二代晶体管时代（1958 年～1964 年）
1. 第三代集成电路时代（1965 年～1970 年）
1. 第四代大规模/超大规模集成电路时代（1971 年至今）

1. <font color='#EF4444'>手工操作</font>

1. <font color='#EF4444'>监控程序（早期批处理）</font>

1. <font color='#EF4444'>多倒批处理</font>

   所谓多道是指允许多个程序同时存在内存中，由 CPU 以切换方式为之服务

   `不适合`交互式作业

1. <font color='#EF4444'>分时系统</font>

   指多个用户通过终端设备于计算机交互作用来运行自己的作业，并且共享一个计算机系统而互不干扰，就好像自己有一台计算机

   `适合`交互式作业

1. <font color='#EF4444'>UNIX通用操作系统</font>

   是用 C 语言编写的，因此它是可移植的

1. <font color='#EF4444'>个人计算机操作系统</font>

1. <font color='#EF4444'>现在操作系统的量大发展方向——宏观应用与微观应用</font>

### 6.操作系统的分类

1. <font color='#EF4444'>批处理操作系统</font>

   特点是<font color='#EF4444'>成批</font>处理

   目标是系统<font color='#EF4444'>资源利用率高，作业吞吐率高</font>

   **优点**：作业流程自动化较高，资源利用率较高，作业吞吐量大

   **缺点**：用户<font color='#EF4444'>不能</font>直接于计算机<font color='#EF4444'>交互</font>，不适合调试程序

   **关键技术**：用多道程序运行、<font color='#EF4444'>假脱机（SPOOLing）</font>技术等

1. <font color='#EF4444'>分时操作系统</font>

   采用时间片轮转方式处理服务请求，并通过交互方式在终端上向用户展示结果

   具有<font color='#EF4444'>多路性</font>、<font color='#EF4444'>交互性</font>、<font color='#EF4444'>独占性</font>和<font color='#EF4444'>及时性</font>的特点

   **多路性**：多个用户同时使用一台计算机

   **交互性**：用户向系统发出请求，系统进行响应

   **独占性**：用户感知不到计算机正在被其他人使用

   **及时性**：系统对用户的请求给予快速响应

1. <font color='#EF4444'>实时操作系统</font>

   1. <font color='#EF4444'>硬实时</font>系统（火箭和导弹控制、飞行控制系统、核反应堆控制等）`高度可靠性`在规定的时间内实时响应外部事件的请求，同时完成对该事件的处理
   1. <font color='#EF4444'>软实时系</font>系统（视频处理、飞机订票）

   能力：

   1. **实时时钟管理**：**定时任务**：**延时任务**：

      任务分为`主动型任务`（主动型任务主要应用于实时监控）与`从动型任务`（运行主要依赖于外部事件的触发）

   1. **过载防护**：有大量的任务需要系统处理，但是任务的数量已经超出了当前系统的处理能力，系统需要有一定的防护能力对意外情况进行处理

   1. **高可靠性**

1. <font color='#EF4444'>个人计算机操作系统</font>

   是一种<font color='#EF4444'>单用户</font>的操作系统

   主要特点是：

   1. 计算机在某一时间内为单个用户服务
   1. 采用图形界面人机交互的工作方式，界面友好
   1. 使用方便，用户无须具备专门知识，也能熟练地操纵系统

1. <font color='#EF4444'>网络操作系统</font>

   <font color='#EF4444'>基于</font>计算机<font color='#EF4444'>网络</font>的、为计算机<font color='#EF4444'>网络配置</font>的操作系统

   1. **集中式模式**
   1. **分布式模式**

1. <font color='#EF4444'>分布式操作系统</font><font color='#409EFF'>机群（cluster）是分布式系统的一种</font>

   将<font color='#EF4444'>大量</font>的计算机通过网络联结到一起，可以获得<font color='#EF4444'>极高的运算能力</font>及实现广泛的<font color='#EF4444'>数据共享</font>

   **特征**：

   1. 分布式操作系统是一个统一的操作系统，在系统中的所有主机使用的是<font color='#EF4444'>同一个</font>操作系统
   1. 实现资源的<font color='#EF4444'>深度共享</font>
   1. <font color='#EF4444'>透明性</font>
   1. <font color='#EF4444'>自治性</font>

   **优点**：

   1. 以<font color='#EF4444'>较低</font>的成本获得<font color='#EF4444'>较高的运算性能</font>
   1. <font color='#EF4444'>可靠性</font>

1. <font color='#EF4444'>嵌入式操作系统</font>

   是一种`实时操作系统`，嵌入式操作系统在<font color='#409EFF'>工业控制</font>、<font color='#409EFF'>交通管理</font>、<font color='#409EFF'>信息家电</font>等

   **特点**：

   1. 系统内核小
   1. 专业性强
   1. 系统精简
   1. 高实时性
   1. 多任务的操作系统

### 7.操作系统设计

1. <font color='#EF4444'>设计难点</font>

   1. 设计复杂程度高
   1. 正确性难以保证
   1. 研制周期长

1. <font color='#EF4444'>设计过程</font>

   1. **功能设计**：根据系统的设计目标和使用要求确定所设计的操作系统应该具备哪些功能

   1. **算法设计**：某些算法能促进操作系统更快的响应

   1. **结构设计**：按照系统的功能和特性要求选择合适的结构，将系统逐层分解，使系统简单适应性强

      <font color='#EF4444'>能结算</font>

1. <font color='#EF4444'>设计目标</font>

   1. 可靠性（正确性和健壮性）

   1. 高效性（提高系统运行的效率）

   1. 易维护性

   1. 可移植性

   1. 安全性

      <font color='#EF4444'>靠高位可安全</font>

1. <font color='#EF4444'>结构设计</font> 

   操作系统结构设计的重要性

   操作系统结构研究的目标

   1. **系统模块化**：具有一定功能的程序块

   1. **模块标准化**：能反应操作系统的成分固定下来，作为标准

   1. **通信规范化**：模块之间的接口清晰划一模块之间的通信方式统一

      <font color='#EF4444'>系统标准通信</font>

### 8.操作系统的体系结构

1. <font color='#EF4444'>整体式结构</font>：将整个操作系统拆分成若干模块，通过接口将这些模块连接在一起

   **优点**：结构紧密、接口简单直接、系统效率较高

   **缺点**：

   1. 模块间转接随便，各<font color='#EF4444'>模块相互牵连</font>，独立性差，系统结构不清晰
   1. 数据基本上作为<font color='#EF4444'>全程量</font>处理，相当<font color='#EF4444'>复杂</font>
   1. 可<font color='#EF4444'>适应性比较差</font>

1. <font color='#EF4444'>层次式结构</font>

   **优点**：

   1. 单向依赖或单向调用，结构清晰，不会构成循环
   1. 很容易对操作系统增加或替换掉一层而不影响其他层次
   1. 易于调试，易于修改、易于扩充、易于维护、易于保证正确性

1. <font color='#EF4444'>客户/服务器（微内核）结构</font>

   最基本功能的<font color='#EF4444'>内核</font>和提供各种服务的<font color='#EF4444'>服务进程两个部分</font>

   **特点**：

   1. 运行在核心态的内核：内核提供所有操作**系统基本**都具有的**操作**
   1. 运行在用户态的并以客户/服务器方式运行的进程层：**除内核部分外**，操作系统所有的其他部分都被分成若干个相对独立的进程，每一个进程实现一组服务，称为**服务进程**

   **优点**：可靠、灵活、适用分布式处理的计算环境

   **缺点**：主要是对于<font color='#EF4444'>效率</font>的考虑，所有的用户进程只能通过微内核相互通信，微内核本身就成为系统的瓶颈

1. <font color='#EF4444'>外核结构</font>

   内核：仅仅为简单的申请操作以及释放和复用硬件资源

   外核：一些关键的硬件资源管理功能放在内核之外，通过一些特殊的机制让应用程序能够更直接地访问和控制这些硬件资源

   比如：传统的操作系统内核会对硬盘资源（像磁盘、内存）进行集中式管理。而外核结构就像是把这些管理权限部分地`下放`，让不同的应用程序或用户程序可以由更多的自主性

### 9.操作系统启动

1. <font color='#EF4444'>引导方式</font>：BIOS引导和UEFI引导

1. <font color='#EF4444'>启动机制</font>：BIOS自检、系统引导、启动内核、初始化系统 

1. <font color='#EF4444'>执行流程</font>：

   1. 用户通过操作系统<font color='#EF4444'>启动程序</font>

   1. 操作系统将程序从磁盘<font color='#EF4444'>加载到内存中</font>

   1. 操作系统为程序<font color='#EF4444'>分配资源</font>，如CPU时间，内存空间和输入输出设备

   1. 程序开始执行，由 CPU 按顺序<font color='#EF4444'>执行</font>指令

   1. 程序可能会与操作系统<font color='#EF4444'>交互</font>，请求服务，如读写文件或访问网络

   1. 程序执行完毕后，操作系统<font color='#EF4444'>回收</font>其占用的<font color='#EF4444'>资源</font>

      <font color='#EF4444'>启动加载分配执行交互回收</font>

### 习题

1. 计算机系统包括<font color='#EF4444'>硬件系统和软件系统</font>
1. 计算机赖以工作的实体是<font color='#EF4444'>硬件系统</font>
1. 在单处理机操作系统中，多个程序交替地在处理器上运行，从宏观上看，这些程序同时向前推进。这体现了操作系统的<font color='#EF4444'>并发性</font>
1. 对 OS 功能的概括中，正确的是：<font color='#EF4444'>进程管理、存储管理、作业管理、用户接口和设备管理</font>
1. 进程控制的主要任务是创建进程、撤销结束的进程以及控制进程运行时的各种<font color='#EF4444'>状态转换</font>
1. 进程间通信主要发生在哪些进程之间<font color='#EF4444'>相互协作</font>
1. 进程约束、进程控制、进程同步、进程调度那一项不属于进程管理的内容<font color='#EF4444'>进程约束</font>
1. 存储管理的任务是管理计算机<font color='#EF4444'>内存的资源</font>
1. 操作系统的发展过程中，按照由早到晚出现的顺序，以下排序正确的是<font color='#EF4444'>手工操作、监控程序、多道批处理，分时/实时系统</font>
1. 实时操作系统的主要目标是在严格的时间范围内，对外部请求做出反应。因此系统应该具有高度的<font color='#EF4444'>可靠性</font>
1. 用户提交作业后，再也无法干预其作业的运行的操作系统是<font color='#EF4444'>批处理操作系统</font>
1. 对可靠性要求极高，并且要求有强健壮性和坚固性的操作系统是<font color='#EF4444'>实时操作系统</font>
1. 将大量的计算机通过网络连结在一起，可以获得极高的运算能力及广泛的数据共享。这样一种系统称为<font color='#EF4444'>分布式系统</font>
1. 操作系统的设计过程一般可分为功能设计、算法设计和<font color='#EF4444'>结构设计</font>
1. 它是操作系统结构研究的目标之一，在该目标下，模块之间的接口清晰划一，模块的联系方式统一。基于上述的描述，操作系统结构研究的这种目标是<font color='#EF4444'>通信规范化</font>
1. 下列关于计算机微内核操作系统结构的描述中，错误的是 <font color='#EF4444'>3</font>
   1. 内核运行在核心态
   1. 具有良好的灵活性，便于操作系统增加新的功能
   1. 模块之间可以任意相互调用，结构紧密，接口简单
   1. 除内核之外，操作系统其他部分以进程方式运行在用户态
1. 将操作系统分成用于实现操作系统最基本功能的内核和提供各种服务的服务进程两个部分，这样的操作系统结构是<font color='#EF4444'>微内核结构</font>

## 第二章 操作系统运行环境与运行机制

### 1. 中央处理器CPU

CPU 一般由<font color='#EF4444'>运算器</font>、<font color='#EF4444'>控制器</font>、一系列的<font color='#EF4444'>寄存器</font>以及<font color='#EF4444'>高速缓存</font>构成

<font color='#EF4444'>运算器</font>实现指令中的<font color='#EF4444'>算术</font>和<font color='#EF4444'>逻辑</font>运算，是计算机计算的核心

<font color='#EF4444'>控制器</font>负责<font color='#EF4444'>控制程序运行</font>的流程，包括取指令、维护CPU状态、CPU 与内存的交互等

<font color='#EF4444'>寄存器</font>：

1. `用户可见`的寄存器，包括：数据寄存器，地址寄存器以及条件码寄存器 <font color='#EF4444'>数地条（速递条）</font>
1. 控制和状态寄存器，常见：程序计数器（PC）、指令寄存器（IR）和<font color='#EF4444'>程序状态字（PSW）</font> <font color='#EF4444'>两程序一指令</font>

<font color='#EF4444'>高速缓存</font>：cache

指令执行的基本过程

开始 $\rightarrow$ 取指令  $\rightarrow$  执行 $\rightarrow$  停止

### 2. 特权指令和非特权指令

<font color='#EF4444'>特权指令</font>：指令系统中那些只能由`操作系统`使用的指令，不允许一般用户使用

如：设置程序状态字、启动某设备、设置中断屏蔽、设置时钟指令、清内存指令和建立存储保护指令等

<font color='#EF4444'>非特权指令</font>：操作系统、普通用户都能使用的

### 3. 处理器的状态

<font color='#EF4444'>内核态</font>：又叫管态、特权态、系统态、核心态

​	指`操作系统`管理程序运行的状态，具有`较高`的特权级别 

<font color='#EF4444'>	系统启动</font>时，CPU的初始状态<font color='#EF4444'>是内核态</font>

<font color='#EF4444'>用户态</font>：又叫目态、普通态

​	指`用户程序`运行时的状态，具有较低的特权级别

<font color='#EF4444'>CPU状态的转换</font>

1. 用户态 $\rightarrow$ 内核态的转换 

   其转换的<font color='#EF4444'>唯一途径</font>是中断。中断响应时交换中断向量，新的中断向量中的 `PSW` 的 CPU 状态位标志为内核态

1. 内核态 $\rightarrow$ 用户态的转换

   可通过<font color='#EF4444'>设置PSW指令</font>（修改程序状态字），实现从操作系统向用户程序的转换



### 练习

1. 在处理器的所有寄存器中，对用户不可见的是
   1. <font color='#EF4444'>指令寄存器</font>
   1. 条件码寄存器
   1. 地址寄存器
   1. 数据寄存器
1. 计算机处理器中用于管理程序运行流程的是
   1. <font color='#EF4444'>控制器</font>
   1. 高速缓存
   1. 运算器
   1. 寄存器
1. 以下属于非特权指令的是
   1. 启动 I/O 设备
   1. 设置中断屏蔽
   1. <font color='#EF4444'>执行数据算数计算</font>
   1. 设置程序状态字
1. 在多用户或多任务的多道程序设计环境中，以下不是特权指令的是
   1. 启动设备
   1. 设置中断屏蔽
   1. 清内存
   1. <font color='#EF4444'>算数运算指令</font>

67C23A 绿色

409EFF 蓝色